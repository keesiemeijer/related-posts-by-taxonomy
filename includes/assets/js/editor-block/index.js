!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.lodash}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(23),r=n(10);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(24);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){!function(){e.exports=this.wp.compose}()},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.exports=n},function(e,t){!function(){e.exports=this.wp.blocks}()},function(e,t){!function(){e.exports=this.wp.data}()},function(e,t,n){var o=n(20),r=n(21),s=n(22);e.exports=function(e){return o(e)||r(e)||s()}},function(e,t,n){var o;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var s=typeof o;if("string"===s||"number"===s)e.push(o);else if(Array.isArray(o)&&o.length){var a=r.apply(null,o);a&&e.push(a)}else if("object"===s)for(var i in o)n.call(o,i)&&o[i]&&e.push(i)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)}()},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){!function(){e.exports=this.wp.apiFetch}()},function(e,t){!function(){e.exports=this.wp.url}()},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t,n){"use strict";n.r(t);var o=n(1),r=n(2),s=n(13),a=n(15),i=n.n(a),c=n(9),l=n.n(c),u=n(4),p=n.n(u),b=n(5),f=n.n(b),m=n(6),y=n.n(m),h=n(7),d=n.n(h),g=n(10),O=n.n(g),j=n(8),v=n.n(j),_=n(0),x=n(16),C=n.n(x),k=n(17),P=n(3),w=n(14),E=n(11),T=window.km_rpbt_plugin_data||{},S={post_types:{type:"object"},taxonomies:{type:"object"},formats:{type:"object"},order:{type:"object"},image_sizes:{type:"object"},default_tax:{type:"string"},default_category:{type:"string"},html5_gallery:{type:"bool",default:!1},show_date:{type:"bool",default:!1}};function N(e,t){return!(!Object(o.isObject)(e)||!e.hasOwnProperty(t))&&!Object(o.isUndefined)(e[t])}function I(e){var t=function(e){var t=Object(o.get)(S,e+".default"),n=Object(o.get)({object:{},string:""},Object(o.get)(S,e+".type"));return Object(o.isUndefined)(t)?n:t}(e);if(!N(T,e)||Object(o.isUndefined)(t))return t;var n=T[e];return function(e,t){var n=!1;switch(e){case"bool":t=function(e){if(!Object(o.isString)(e))return e;var t=Number(e.trim());return 1===t||0===t?1===t:e}(t),n=Object(o.isBoolean)(t);break;case"object":n=Object(o.isObject)(t);break;case"string":n=Object(o.isString)(t)}return n}(Object(o.get)(S,e+".type"),n)?n:t}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=I(e);for(var o in n)n.hasOwnProperty(o)&&t.push({label:n[o],value:o});return t}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],n=I("post_types");for(var o in n)n.hasOwnProperty(o)&&t.push({post_type:o,label:n[o],checked:-1!==e.indexOf(o)});return t}var R=function(e){function t(){var e;p()(this,t);var n=(e=y()(this,d()(t).apply(this,arguments))).props.postTypes;return e.state={items:A(n.split(","))},e}return v()(t,e),f()(t,[{key:"onChange",value:function(e){var t=this.state.items.slice();t[e].checked=!t[e].checked,this.setState({items:t});var n=this.state.items.filter((function(e){return e.checked})).map((function(e){return e.post_type}));this.props.onChange&&this.props.onChange(n.join(","))}},{key:"render",value:function(){var e=this,t=this.props,n=t.label,r=t.help,s=t.instanceId,a=t.postTypes,i="inspector-multi-checkbox-control-"+s;var c=a.split(",");return c=c.filter((function(e){return t=e,N(I("post_types"),t);var t})),!Object(o.isEmpty)(this.state.items)&&Object(_.createElement)(P.BaseControl,{label:n,id:i,help:r,className:"blocks-checkbox-control"},this.state.items.map((function(t,n){return Object(_.createElement)("div",{key:i+"-"+n,className:"blocks-checkbox-control__option"},Object(_.createElement)("input",{id:i+"-"+n,className:"blocks-checkbox-control__input",type:"checkbox",name:i+"-"+n,value:t.post_type,onChange:e.onChange.bind(e,n),checked:!(-1===c.indexOf(t.post_type)),"aria-describedby":r?i+"__help":void 0}),Object(_.createElement)("label",{key:t.post_type,htmlFor:i+"-"+n},t.label))})))}}]),t}(_.Component),M=Object(E.withInstanceId)(R),z=D("taxonomies",[{label:Object(r.__)("all taxonomies","related-posts-by-taxonomy"),value:"km_rpbt_all_tax"}]),F=D("formats"),U=D("order");function B(e){var t=e.taxonomies,n=e.onTaxonomiesChange,o=e.postsPerPage,s=e.onPostsPerPageChange,a=e.format,i=e.onFormatChange,c=e.showDate,l=e.onShowDateChange,u=e.postTypes,p=e.onPostTypesChange,b=e.order,f=e.onOrderChange;return[s&&Object(_.createElement)(P.RangeControl,{key:"rpbt-range-posts-per-page",label:Object(r.__)("Number of items","related-posts-by-taxonomy"),value:o,onChange:s,min:-1,max:100}),n&&Object(_.createElement)(P.SelectControl,{key:"rpbt-select-taxonomies",label:Object(r.__)("Taxonomies","related-posts-by-taxonomy"),value:"".concat(t),options:z,onChange:function(e){n(e)}}),p&&Object(_.createElement)(M,{label:Object(r.__)("Post Types","related-posts-by-taxonomy"),onChange:p,postTypes:u}),f&&Object(_.createElement)(P.SelectControl,{key:"rpbt-select-order",label:Object(r.__)("Order posts","related-posts-by-taxonomy"),value:"".concat(b),options:U,onChange:function(e){f(e)}}),i&&Object(_.createElement)(P.SelectControl,{key:"rpbt-select-format",label:Object(r.__)("Format","related-posts-by-taxonomy"),value:"".concat(a),options:F,onChange:function(e){i(e)}}),l&&Object(_.createElement)(P.ToggleControl,{label:Object(r.__)("Display post date","related-posts-by-taxonomy"),checked:c,onChange:l})]}var L=D("image_sizes");function q(e){var t=e.imageSize,n=e.onImageSizeChange,o=e.columns,s=e.onColumnsChange;return[n&&Object(_.createElement)(P.SelectControl,{key:"rpbt-select-image-size",label:Object(r.__)("Image Size","related-posts-by-taxonomy"),value:"".concat(t),options:L,onChange:function(e){n(e)}}),s&&Object(_.createElement)(P.RangeControl,{key:"rpbt-range-columns",label:Object(r.__)("Image Columns","related-posts-by-taxonomy"),value:o,onChange:s,min:0,max:20})]}var H=n(12),G=n.n(H),Q=n(18),W=n.n(Q),V=n(19);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=null!==t?t:{};return o.gallery_format="editor_block",o.is_editor=!0,Object(V.addQueryArgs)("/related-posts-by-taxonomy/v1/posts/".concat(e),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o,{},n))}var X=function(e){function t(e){var n;return p()(this,t),(n=y()(this,d()(t).call(this,e))).state={response:null},n}return v()(t,e),f()(t,[{key:"componentDidMount",value:function(){this.isStillMounted=!0,this.fetch(this.props),this.fetch=Object(o.debounce)(this.fetch,500)}},{key:"componentWillUnmount",value:function(){this.isStillMounted=!1}},{key:"componentDidUpdate",value:function(e){Object(o.isEqual)(e.attributes,this.props.attributes)||this.fetch(this.props)}},{key:"fetch",value:function(e){var t=this;if(this.isStillMounted){null!==this.state.response&&this.setState({response:null});var n=e.postID,o=e.attributes,r=void 0===o?null:o,s=e.urlQueryArgs,a=K(n,r,void 0===s?{}:s),i=this.currentFetchRequest=W()({path:a}).then((function(e){t.isStillMounted&&i===t.currentFetchRequest&&e&&t.setState({response:e.rendered})})).catch((function(e){t.isStillMounted&&i===t.currentFetchRequest&&t.setState({response:{error:!0,errorMsg:e.message}})}));return i}}},{key:"render",value:function(){var e=this.state.response,t=this.props,n=t.className,o=t.EmptyResponsePlaceholder,r=t.ErrorResponsePlaceholder,s=t.LoadingResponsePlaceholder;return""===e?Object(_.createElement)(o,G()({response:e},this.props)):e?e.error?Object(_.createElement)(r,G()({response:e},this.props)):Object(_.createElement)(_.RawHTML,{key:"html",className:n},e):Object(_.createElement)(s,G()({response:e},this.props))}}]),t}(_.Component);X.defaultProps={EmptyResponsePlaceholder:function(e){var t=e.className;return Object(_.createElement)(P.Placeholder,{className:t},Object(r.__)("No posts found with the current block settings","related-posts-by-taxonomy"))},ErrorResponsePlaceholder:function(e){var t=e.response,n=e.className,o=Object(r.sprintf)(Object(r.__)("Error loading block: %s","related-posts-by-taxonomy"),t.errorMsg);return Object(_.createElement)(P.Placeholder,{className:n},o)},LoadingResponsePlaceholder:function(e){var t=e.className;return Object(_.createElement)(P.Placeholder,{className:t},Object(_.createElement)(P.Spinner,null))}};var Y=X,Z=0,$=function(e){function t(){var e;return p()(this,t),(e=y()(this,d()(t).apply(this,arguments))).html5Gallery=I("html5_gallery"),e.defaultCategory=I("default_category"),e.updatePostTypes=e.updatePostTypes.bind(O()(e)),e.onTitleChange=e.onTitleChange.bind(O()(e)),e.titleDebounced=Object(o.debounce)(e.updateTitle,1e3),e.toggleLinkCaption=e.createToggleAttribute("link_caption"),e.toggleShowDate=e.createToggleAttribute("show_date"),e.toggleImageCrop=e.createToggleAttribute("image_crop"),e.instanceId=Z++,e}return v()(t,e),f()(t,[{key:"createToggleAttribute",value:function(e){var t=this;return function(){var n=t.props.attributes[e];(0,t.props.setAttributes)(l()({},e,!n))}}},{key:"getImageCropHelp",value:function(e){return e?Object(r.__)("Thumbnails are cropped to align.","related-posts-by-taxonomy"):Object(r.__)("Thumbnails are not cropped.","related-posts-by-taxonomy")}},{key:"componentWillUnmount",value:function(){this.titleDebounced.cancel()}},{key:"onTitleChange",value:function(e){this.titleDebounced(e.target.value)}},{key:"updateTitle",value:function(e){(0,this.props.setAttributes)({title:e})}},{key:"updatePostTypes",value:function(e){(0,this.props.setAttributes)({post_types:e})}},{key:"render",value:function(){var e=this.props,t=e.attributes,n=e.setAttributes,s=e.postType,a=e.postID,i=e.termIDs,c=e.taxonomyNames,l=t.title,u=t.taxonomies,p=t.post_types,b=t.posts_per_page,f=t.format,m=t.image_size,y=t.columns,h=t.link_caption,d=t.show_date,g=t.order,O=(t.fields,t.image_crop),j="inspector-text-control-"+this.instanceId,v=C()(this.props.className,{"rpbt-html5-gallery":"thumbnails"===f&&this.html5Gallery});if(Object(o.isUndefined)(i)||Object(o.isUndefined)(c))return null;var x=Object.assign({},t);x.post_id=a,x.include_terms=i.join(","),x.include_terms.length||-1===c.indexOf("category")||(x.include_terms=this.defaultCategory);var w=p;!Object(o.isUndefined)(p)&&p||(w=s);var E=Object(_.createElement)(k.InspectorControls,null,Object(_.createElement)(P.PanelBody,{title:Object(r.__)("Related Posts Settings","related-posts-by-taxonomy")},Object(_.createElement)("div",{className:this.props.className+"-inspector-controls"},Object(_.createElement)("div",null,Object(_.createElement)("p",null,Object(r.__)("Note: The preview style is not the actual style used in the front end of your site.","related-posts-by-taxonomy"))),Object(_.createElement)(P.BaseControl,{label:Object(r.__)("Title","related-posts-by-taxonomy"),id:j},Object(_.createElement)("input",{className:"components-text-control__input",type:"text",onChange:this.onTitleChange,defaultValue:l,id:j})),Object(_.createElement)(B,{postsPerPage:b,onPostsPerPageChange:function(e){var t=0===Number(e)?1:e;n({posts_per_page:Number(t)})},taxonomies:u,onTaxonomiesChange:function(e){return n({taxonomies:e})},format:f,onFormatChange:function(e){return n({format:e})},order:g,onOrderChange:function(e){return n({order:e})},showDate:d,onShowDateChange:this.toggleShowDate,postTypes:w,onPostTypesChange:this.updatePostTypes}))),Object(_.createElement)(P.PanelBody,{title:Object(r.__)("Image Settings","related-posts-by-taxonomy")},Object(_.createElement)(q,{imageSize:m,onImageSizeChange:function(e){return n({image_size:e})},columns:y,onColumnsChange:function(e){return n({columns:Number(e)})}}),Object(_.createElement)(P.ToggleControl,{label:Object(r.__)("Crop Images","related-posts-by-taxonomy"),checked:O,onChange:this.toggleImageCrop,help:this.getImageCropHelp}),Object(_.createElement)(P.ToggleControl,{label:Object(r.__)(" Link image captions to posts","related-posts-by-taxonomy"),checked:h,onChange:this.toggleLinkCaption})));return Object(_.createElement)(_.Fragment,null,E,Object(_.createElement)("div",{className:v},Object(_.createElement)(Y,{block:"related-posts-by-taxonomy/related-posts-block",postID:a,attributes:x})))}}]),t}(_.Component),ee=Object(E.compose)(Object(w.withSelect)((function(e,t){return{postID:e("core/editor").getCurrentPostId(),postType:e("core/editor").getCurrentPostType(),registeredTaxonomies:e("core").getTaxonomies()}})),Object(w.withSelect)((function(e,t){if(!t.registeredTaxonomies||!t.postType||!t.postID)return null;var n=[],r=[],s=t.registeredTaxonomies;return Object(o.filter)(s,(function(e){return Object(o.includes)(e.types,t.postType)})).map((function(t){r.push(t.slug);var s=e("core/editor").getEditedPostAttribute(t.rest_base);Object(o.isArray)(s)&&n.push.apply(n,i()(s))})),{taxonomyNames:r,termIDs:n}})))($);Object(o.isEmpty)(T)||Object(s.registerBlockType)("related-posts-by-taxonomy/related-posts-block",{title:Object(r.__)("Related Posts by Taxonomy","related-posts-by-taxonomy"),icon:"megaphone",category:"widgets",description:Object(r.__)("This block displays related posts by taxonomy.","related-posts-by-taxonomy"),supports:{html:!1,customClassName:!1},edit:ee,save:function(){return null}})}]);