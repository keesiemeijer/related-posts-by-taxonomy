!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.lodash}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(17),r=n(11);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(18);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){!function(){e.exports=this.wp.compose}()},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){!function(){e.exports=this.wp.data}()},function(e,t){!function(){e.exports=this.wp.blocks}()},function(e,t,n){var o;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var i=typeof o;if("string"===i||"number"===i)e.push(o);else if(Array.isArray(o)&&o.length){var s=r.apply(null,o);s&&e.push(s)}else if("object"===i)for(var a in o)n.call(o,a)&&o[a]&&e.push(a)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)}()},function(e,t){!function(){e.exports=this.wp.editor}()},function(e,t){!function(){e.exports=this.wp.url}()},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t,n){"use strict";n.r(t);var o=n(1),r=n(2),i=n(13),s=n(12),a=n(9),c=n(10),l=n.n(c),u=n(4),p=n.n(u),b=n(5),f=n.n(b),h=n(6),m=n.n(h),y=n(7),d=n.n(y),g=n(11),O=n.n(g),j=n(8),v=n.n(j),_=n(0),x=n(14),C=n.n(x),k=n(15),w=n(3),P=window.km_rpbt_plugin_data||{},T={post_types:{type:"object"},taxonomies:{type:"object"},formats:{type:"object"},order:{type:"object"},image_sizes:{type:"object"},default_tax:{type:"string"},all_tax:{type:"string"},default_category:{type:"string"},preview:{type:"bool",default:!0},html5_gallery:{type:"bool",default:!1},show_date:{type:"bool",default:!1}};function E(e,t){return!(!Object(o.isObject)(e)||!e.hasOwnProperty(t))&&!Object(o.isUndefined)(e[t])}function S(e){var t=function(e){var t=Object(o.get)(T,e+".default"),n=Object(o.get)({object:{},string:""},Object(o.get)(T,e+".type"));return Object(o.isUndefined)(t)?n:t}(e);if(!E(P,e)||Object(o.isUndefined)(t))return t;var n=P[e];return function(e,t){var n=!1;switch(e){case"bool":t=function(e){if(!Object(o.isString)(e))return e;var t=Number(e.trim());return 1===t||0===t?1===t:e}(t),n=Object(o.isBoolean)(t);break;case"object":n=Object(o.isObject)(t);break;case"string":n=Object(o.isString)(t)}return n}(Object(o.get)(T,e+".type"),n)?n:t}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=S(e);for(var o in n)n.hasOwnProperty(o)&&t.push({label:n[o],value:o});return t}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],n=S("post_types");for(var o in n)n.hasOwnProperty(o)&&t.push({post_type:o,label:n[o],checked:-1!==e.indexOf(o)});return t}var N=function(e){function t(){var e;p()(this,t);var n=(e=m()(this,d()(t).apply(this,arguments))).props.postTypes;return e.state={items:I(n.split(","))},e}return v()(t,e),f()(t,[{key:"onChange",value:function(e){var t=this.state.items.slice();t[e].checked=!t[e].checked,this.setState({items:t});var n=this.state.items.filter((function(e){return e.checked})).map((function(e){return e.post_type}));this.props.onChange&&this.props.onChange(n.join(","))}},{key:"render",value:function(){var e=this,t=this.props,n=t.label,r=t.help,i=t.instanceId,s=t.postTypes,a="inspector-multi-checkbox-control-"+i;var c=s.split(",");return c=c.filter((function(e){return t=e,E(S("post_types"),t);var t})),!Object(o.isEmpty)(this.state.items)&&Object(_.createElement)(w.BaseControl,{label:n,id:a,help:r,className:"blocks-checkbox-control"},this.state.items.map((function(t,n){return Object(_.createElement)("div",{key:a+"-"+n,className:"blocks-checkbox-control__option"},Object(_.createElement)("input",{id:a+"-"+n,className:"blocks-checkbox-control__input",type:"checkbox",name:a+"-"+n,value:t.post_type,onChange:e.onChange.bind(e,n),checked:!(-1===c.indexOf(t.post_type)),"aria-describedby":r?a+"__help":void 0}),Object(_.createElement)("label",{key:t.post_type,htmlFor:a+"-"+n},t.label))})))}}]),t}(_.Component),M=Object(a.withInstanceId)(N),A=D("taxonomies",[{label:Object(r.__)("all taxonomies"),value:"km_rpbt_all_tax"}]),z=D("formats"),F=D("order");function R(e){var t=e.taxonomies,n=e.onTaxonomiesChange,o=e.postsPerPage,i=e.onPostsPerPageChange,s=e.format,a=e.onFormatChange,c=e.showDate,l=e.onShowDateChange,u=e.postTypes,p=e.onPostTypesChange,b=e.order,f=e.onOrderChange;return[i&&Object(_.createElement)(w.RangeControl,{key:"rpbt-range-posts-per-page",label:Object(r.__)("Number of items"),value:o,onChange:i,min:-1,max:100}),n&&Object(_.createElement)(w.SelectControl,{key:"rpbt-select-taxonomies",label:Object(r.__)("Taxonomies"),value:"".concat(t),options:A,onChange:function(e){n(e)}}),p&&Object(_.createElement)(M,{label:Object(r.__)("Post Types"),onChange:p,postTypes:u}),f&&Object(_.createElement)(w.SelectControl,{key:"rpbt-select-order",label:Object(r.__)("Order posts"),value:"".concat(b),options:F,onChange:function(e){f(e)}}),a&&Object(_.createElement)(w.SelectControl,{key:"rpbt-select-format",label:Object(r.__)("Format"),value:"".concat(s),options:z,onChange:function(e){a(e)}}),l&&Object(_.createElement)(w.ToggleControl,{label:Object(r.__)("Display post date"),checked:c,onChange:l})]}var U=D("image_sizes");function B(e){var t=e.imageSize,n=e.onImageSizeChange,o=e.columns,i=e.onColumnsChange;return[n&&Object(_.createElement)(w.SelectControl,{key:"rpbt-select-image-size",label:Object(r.__)("Image Size"),value:"".concat(t),options:U,onChange:function(e){n(e)}}),i&&Object(_.createElement)(w.RangeControl,{key:"rpbt-range-columns",label:Object(r.__)("Image Columns"),value:o,onChange:i,min:0,max:20})]}var q=n(16);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var G=wp.components,Q=G.Placeholder,W=G.Spinner,H=wp.apiFetch;function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=null!==t?t:{};return o.gallery_format="editor_block",o.is_editor=!0,o.link_caption=!1,Object(q.addQueryArgs)("/related-posts-by-taxonomy/v1/posts/".concat(e),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o,{},n))}var J=function(e){function t(e){var n;return p()(this,t),(n=m()(this,d()(t).call(this,e))).state={response:null},n}return v()(t,e),f()(t,[{key:"componentDidMount",value:function(){this.isStillMounted=!0,this.fetch(this.props),this.fetch=Object(o.debounce)(this.fetch,500)}},{key:"componentWillUnmount",value:function(){this.isStillMounted=!1}},{key:"componentDidUpdate",value:function(e){Object(o.isEqual)(e,this.props)||this.fetch(this.props)}},{key:"fetch",value:function(e){var t=this;if(this.isStillMounted){null!==this.state.response&&this.setState({response:null});var n=e.postID,o=e.attributes,r=void 0===o?null:o,i=e.urlQueryArgs,s=V(n,r,void 0===i?{}:i),a=this.currentFetchRequest=H({path:s}).then((function(e){t.isStillMounted&&a===t.currentFetchRequest&&e&&e.rendered&&t.setState({response:e.rendered})})).catch((function(e){t.isStillMounted&&a===t.currentFetchRequest&&t.setState({response:{error:!0,errorMsg:e.message}})}));return a}}},{key:"render",value:function(){var e=this.state.response;if(!e)return Object(_.createElement)(Q,null,Object(_.createElement)(W,null));if(e.error){var t=Object(r.sprintf)(Object(r.__)("Error loading post: %s"),e.errorMsg);return Object(_.createElement)(Q,null,t)}return e.length?Object(_.createElement)(_.RawHTML,{key:"html"},e):Object(_.createElement)(Q,null,Object(r.__)("No results found."))}}]),t}(_.Component),K=0,X=function(e){function t(){var e;return p()(this,t),(e=m()(this,d()(t).apply(this,arguments))).previewExpanded=S("preview"),e.html5Gallery=S("html5_gallery"),e.defaultCategory=S("default_category"),e.updatePostTypes=e.updatePostTypes.bind(O()(e)),e.onTitleChange=e.onTitleChange.bind(O()(e)),e.titleDebounced=Object(o.debounce)(e.updateTitle,1e3),e.toggleLinkCaption=e.createToggleAttribute("link_caption"),e.toggleShowDate=e.createToggleAttribute("show_date"),e.instanceId=K++,e}return v()(t,e),f()(t,[{key:"createToggleAttribute",value:function(e){var t=this;return function(){var n=t.props.attributes[e];(0,t.props.setAttributes)(l()({},e,!n))}}},{key:"componentWillUnmount",value:function(){this.titleDebounced.cancel()}},{key:"onTitleChange",value:function(e){this.titleDebounced(e.target.value)}},{key:"updateTitle",value:function(e){(0,this.props.setAttributes)({title:e})}},{key:"updatePostTypes",value:function(e){(0,this.props.setAttributes)({post_types:e})}},{key:"render",value:function(){var e=this.props,t=e.attributes,n=e.setAttributes,i=e.editorData,s=e.postType,a=e.postID,c=t.title,l=t.taxonomies,u=t.post_types,p=t.posts_per_page,b=t.format,f=t.image_size,h=t.columns,m=t.link_caption,y=t.show_date,d=t.order,g=(t.fields,"inspector-text-control-"+this.instanceId),O=C()(this.props.className,{"rpbt-html5-gallery":"thumbnails"===b&&this.html5Gallery});if(Object(o.isUndefined)(i))return null;var j=Object.assign({},t);j.post_id=a,j.terms=i.termIDs.join(","),j.terms.length||-1===i.taxonomyNames.indexOf("category")||(j.terms=this.defaultCategory);var v=u;!Object(o.isUndefined)(u)&&u||(v=s);var x=Object(_.createElement)(k.InspectorControls,null,Object(_.createElement)(w.PanelBody,{title:Object(r.__)("Related Posts Settings")},Object(_.createElement)("div",{className:this.props.className+"-inspector-controls"},Object(_.createElement)("div",null,Object(_.createElement)("p",null,Object(r.__)("Note: The preview style is not the actual style used in the front end of your site."))),Object(_.createElement)(w.BaseControl,{label:Object(r.__)("Title"),id:g},Object(_.createElement)("input",{className:"components-text-control__input",type:"text",onChange:this.onTitleChange,defaultValue:c,id:g})),Object(_.createElement)(R,{postsPerPage:p,onPostsPerPageChange:function(e){var t=0===Number(e)?1:e;n({posts_per_page:Number(t)})},taxonomies:l,onTaxonomiesChange:function(e){return n({taxonomies:e})},format:b,onFormatChange:function(e){return n({format:e})},order:d,onOrderChange:function(e){return n({order:e})},showDate:y,onShowDateChange:this.toggleShowDate,postTypes:v,onPostTypesChange:this.updatePostTypes}))),Object(_.createElement)(w.PanelBody,{title:Object(r.__)("Image Settings")},Object(_.createElement)(B,{imageSize:f,onImageSizeChange:function(e){return n({image_size:e})},columns:h,onColumnsChange:function(e){return n({columns:Number(e)})}}),Object(_.createElement)(w.ToggleControl,{label:Object(r.__)(" Link image captions to posts"),checked:m,onChange:this.toggleLinkCaption})));return Object(_.createElement)(_.Fragment,null,x,Object(_.createElement)("div",{className:O},Object(_.createElement)(J,{block:"related-posts-by-taxonomy/related-posts-block",postID:a,attributes:j})))}}]),t}(_.Component);Object(o.isEmpty)(P)||Object(i.registerBlockType)("related-posts-by-taxonomy/related-posts-block",{title:Object(r.__)("Related Posts by Taxonomy"),icon:"megaphone",category:"widgets",description:Object(r.__)("This block displays related posts by taxonomy."),supports:{html:!1,customClassName:!1},edit:Object(a.compose)(Object(s.withSelect)((function(e,t){return{postID:e("core/editor").getCurrentPostId(),postType:e("core/editor").getCurrentPostType(),registeredTaxonomies:e("core").getTaxonomies()}})),Object(s.withSelect)((function(e,t){if(!t.registeredTaxonomies||!t.postType||!t.postID)return null;var n={},r=[],i=t.registeredTaxonomies;Object(o.filter)(i,(function(e){return Object(o.includes)(e.types,t.postType)})).map((function(t){n[t.slug]=e("core/editor").getEditedPostAttribute(t.rest_base),r.push(t.slug)}));var s=Object(o.pickBy)(n,(function(e){return e.length})),a=Object.keys(s).map((function(e){return s[e]}));return{editorData:{taxonomyTerms:n,taxonomyNames:r,termIDs:Object(o.flatten)(a)}}})))(X),save:function(){return null}})}]);